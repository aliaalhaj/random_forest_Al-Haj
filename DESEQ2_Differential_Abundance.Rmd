---
title: "DESEQ2_Differential_Abundance"
author: "Alia Al-Haj"
date: "October 25, 2019"
output: html_document
---

DESeq2 can only look at differential abundance between two groups. If you want to look at the differential abundance between two groups use DESeq2.
Metagenomeseq can determine features that are differentially abundant between two or more groups of multiple samples.DESeq2 can only look at differential abundance between two groups. If you want to look at the differential abundance between two groups use DESeq2.
Metagenomeseq can determine features that are differentially abundant between two or more groups of multiple samples. This file works with DESEQ2.

First we need to convert the phyloseq object to a deseq2 object. Then perform basic statistics on the dataset to look for differences amongst depths.
```{r}
library("DESeq2")
#convert phyloseq object to deseq
sample_data(ps)$Depth <- as.factor(sample_data(ps)$Depth)
ds = phyloseq_to_deseq2(ps, ~ Depth)
ds = DESeq(ds)
```

Plot differential abundance:
```{r}
library("ggplot2")
theme_set(theme_bw())
scale_fill_discrete <- function(palname = "Set1", ...) {
    scale_fill_brewer(palette = palname, ...)
}
# Phylum order
x = tapply(sigtab$log2FoldChange, sigtab$Phylum, function(x) max(x))
x = sort(x, TRUE)
sigtab$Phylum = factor(as.character(sigtab$Phylum), levels=names(x))
# Class order
x = tapply(sigtab$log2FoldChange, sigtab$Class, function(x) max(x))
x = sort(x, TRUE)
sigtab$Class = factor(as.character(sigtab$Class), levels=names(x))
ggplot(sigtab, aes(x=Class, y=log2FoldChange, color=Phylum)) + geom_point(size=6) + 
  theme(axis.text.x = element_text(angle = -90, hjust = 0, vjust=0.5))
```


First we need to convert the phyloseq object to a deseq2 object. Then perform basic statistics on the dataset to look for differences amongst depths.
```{r}
library("DESeq2")
#convert phyloseq object to deseq
sample_data(ps)$Depth <- as.factor(sample_data(ps)$Depth)
ds = phyloseq_to_deseq2(ps, ~ Depth)
ds = DESeq(ds)
```

Plot differential abundance:
```{r}
library("ggplot2")
theme_set(theme_bw())
scale_fill_discrete <- function(palname = "Set1", ...) {
    scale_fill_brewer(palette = palname, ...)
}
# Phylum order
x = tapply(sigtab$log2FoldChange, sigtab$Phylum, function(x) max(x))
x = sort(x, TRUE)
sigtab$Phylum = factor(as.character(sigtab$Phylum), levels=names(x))
# Class order
x = tapply(sigtab$log2FoldChange, sigtab$Class, function(x) max(x))
x = sort(x, TRUE)
sigtab$Class = factor(as.character(sigtab$Class), levels=names(x))
ggplot(sigtab, aes(x=Class, y=log2FoldChange, color=Phylum)) + geom_point(size=6) + 
  theme(axis.text.x = element_text(angle = -90, hjust = 0, vjust=0.5))
```
